<html>
<head>
<title>Pattern marker example with Three.js</title>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
<style>
html,body {
	margin: 0;
	padding: 0;
	width: 100%;
	text-align: center;
	overflow-x: hidden;
}
.isHidden {
  opacity: 0;
}
#enemyTitle {
  font-size: 1em;
	line-height: 1.5em;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
	height: 100%;
	width: 100%;
	font-family: sans-serif;
	position: relative;
	z-index: 1000;
}
#battleOverlay {
	position: absolute;
	z-index: 9;
	top: 0;
	left: 0;
	color: white;
	height: 100%;
	width: 100%;
	background-color: rgba(0, 0, 0, 0.3);
}
.enemyStats {
	display: flex;
	flex-direction: column;
	align-items: flex-start;
	width: 13em;
	font-weight: 100;
	background-color: rgba(0, 0, 0, 0.7);
}
.enemyStats div {
	padding: .1em;
	padding-left: .3em;
	padding-right: .3em;
}
.enemyName {
	display: flex;
	width: 12.5em;
	justify-content: space-between;
}
.divider {
	margin-top: .2em;
	margin-bottom: .2em;
	border-bottom: 1px solid white;
	width: 13em;
}
.loot {
	display: flex;
	flex-direction: column;
	align-items: flex-start;
}
.loot div {
	margin-left: .5em;
	font-size: .9em;
}
.loot div:first-of-type {
	padding-left: 0;
	margin-left: 0;
	font-size: 1em;
}
#soloFight, #multiFight {
	cursor: pointer;
	width: 13em;
	height: 1.5em;
	display: flex;
	align-items: center;
	justify-content: center;
}
</style>
</head>

  <body style='margin : 0px; overflow: hidden;'>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"></script>
    <!-- pre fight title screen -->
     <div id="enemyTitle" class="isHidden">
       <div class="enemyStats">
         <div class="enemyName"><span>Cactaur</span><span>Lvl. 20</span></div>
         <span class="divider"></span>
         <div>HP: 1000/1000</div>
         <div>MP: 50/50</div>
         <div>EXP: 20,000</div>
         <div class="loot">
           <div>Loot:</div>
           <div>Rare: Katana</div>
           <div>Common: Hi-Potion</div>
         </div>
         <span class="divider"></span>
         <div id="soloFight">Solo Battle</div>
         <span class="divider"></span>
         <div id="multiFight">Multi Battle</div>
       </div>
    </div>
    <div id="battleOverlay" class="isHidden">
      <div id="message-current"></div>
      <div id="message-bossName"></div>
      <div>
        HP
        <span id="message-bossHp"></span>/<span id="message-bossMaxHp"></span>
      </div>
      <div>
        HP
        <span id="message-playerHp"></span>/<span id="message-playerMaxHp"></span>
      </div>
      <button id="attack"></button>
    </div>
    <div id="a-sceneContainer">
      <!-- Markercode from here -->
      <!-- https://aframe.io/blog/arjs/#move-the-camera-or-the-marker -->
    	<a-scene embedded arjs='sourceType: webcam;'>
        <a-marker id="a-marker" preset='hiro'>
          <a-plane src="cactaur.png" position='0 0.5 0' material='opacity: 1;' rotation='-90 0 0' width="2" height="2"></a-plane>
        </a-marker>
        <!-- define a simple camera -->
        <a-entity camera></a-entity>
    	</a-scene>
    </div>
  </body>
  <script>
    var queueCounter = 0;
    var soloFight = document.getElementById('soloFight');
    var multiFight = document.getElementById('multiFight');
    var markerFound = false;
    var playerId = Math.random().toFixed(3).toString().replace('0.', '');
    // waiting for marker to be found after page is loaded
    document.getElementById('enemyTitle').classList.remove('isHidden'); //debug
    // uncomment below for release
    var hideBattle = setInterval(() => {
      if (document.getElementById('a-marker').object3D.visible) {
        document.getElementById('enemyTitle').classList.remove('isHidden');
        markerFound = true;
        clearInterval(hideBattle);
      }
    }, 500);
    soloFight.addEventListener('click', () => {
      playerId = '001';
      document.getElementById('enemyTitle').classList.add('isHidden');
      document.getElementById('battleOverlay').classList.remove('isHidden');
      console.log('starting solo')
      // no need for server at this point, we'll just run game loop on client
      // in a full version we would need to go through server to prevent cheating
      let cactaur = {
        name: 'Cactaur',
        attack: '100',
        actions: ['100 needles', 'escape', '10 needles', 'thinking about an escape!'], // add an easy attack to help win?
        dead: false,
        hp: 1000,
        maxHp: 1000,
        escapeCounter: 0,
        '100 needles': 100,
        '10 needles': 10
      }
      let player = {
        number: 1,
        hp: 300,
        maxHp: 300,
        attack: 100,
        critcal: 300,
        actions: ['attack', 'critical', 'heal', 'miss']
      }
      let gameState = {
        id: 'solo',
        queue: [cactaur, '001'],
        queueCounter: 0,
        boss: cactaur,
        currentMessage: 'Battle Start!',
        playerMap: {
          '001': player
        }
      }

      let gameLoop = (gameState) => {
        return gameState
      }
      document.getElementById('message-bossName').innerText = gameState.boss.name;
      document.getElementById('message-playerMaxHp').innerText = gameState.playerMap[playerId].maxHp;
      document.getElementById('message-bossMaxHp').innerText = gameState.boss.maxHp;
      let updateDisplay = (gameState) => {
        let currentMsg = document.getElementById('message-current')
        let bossHp = document.getElementById('message-bossHp')
        let playerHp = document.getElementById('message-playerHp')
        // update player hp
        playerHp.innerText = gameState.playerMap[playerId].hp;

      }
      updateDisplay(gameState);
      // gameloop
      let game = setInterval(() => {
        let newState = gameLoop(gameState);
        if (newState.gameover) {
          updateDisplay(gameState);
          clearInterval(game);
        }
        if (newState.queueCounter !== queueCounter) {
          updateDisplay(newState);
        }
      }, 500)
    })
  </script>
















</html>
